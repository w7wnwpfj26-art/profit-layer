# OKX Wallet Auto Approve - 浏览器插件

> 🔓 自动确认 OKX 钱包的交易授权请求，支持所有 EVM 链

## ✨ 功能特性

- ✅ **完全自动化**：自动检测并点击 OKX 钱包的确认按钮
- 🌐 **多链支持**：支持所有 EVM 兼容链（以太坊、BSC、Arbitrum、Base 等）
- ⚡ **智能延迟**：可配置延迟时间，模拟人类行为
- 📊 **统计追踪**：记录自动确认次数和时间
- 🎨 **精美界面**：现代化的弹窗控制面板
- 🔒 **安全可控**：可随时启用/禁用，支持黑白名单（待扩展）

## 📦 安装步骤

### 1. 生成图标

由于浏览器插件需要图标文件，请先生成图标：

```bash
# 在插件目录下打开 create-icons.html
open create-icons.html
```

或者手动创建三个图标文件（随便找三个图片重命名即可）：
- `icon16.png` (16x16)
- `icon48.png` (48x48)
- `icon128.png` (128x128)

### 2. 加载插件到 Chrome

1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions/`
3. 开启右上角的「**开发者模式**」
4. 点击「**加载已解压的扩展程序**」
5. 选择插件目录：`/Users/wangqi/Documents/ai/dapp/packages/okx-auto-approve`
6. 完成！插件图标会出现在浏览器工具栏

### 3. Firefox 安装（可选）

1. 打开 Firefox
2. 访问 `about:debugging#/runtime/this-firefox`
3. 点击「**临时载入附加组件**」
4. 选择 `manifest.json` 文件

## 🎮 使用方法

### 基本使用

1. **点击插件图标**打开控制面板
2. **确保「自动确认」和「插件启用」都是开启状态**
3. 访问任意 DeFi 网站（如 Uniswap、Aave 等）
4. 进行需要钱包授权的操作（Swap、Approve、Stake 等）
5. 插件会自动检测 OKX 钱包弹窗并点击确认按钮
6. 看到右上角绿色提示：「✅ 已自动确认交易」

### 配置选项

| 选项 | 说明 | 默认值 |
|------|------|--------|
| 自动确认 | 是否自动点击确认按钮 | ✅ 开启 |
| 插件启用 | 总开关 | ✅ 开启 |
| 确认延迟 | 延迟时间（毫秒），避免被检测 | 500ms |

### 统计信息

控制面板底部显示：
- **自动确认次数**：累计自动确认的交易数量
- **最后确认**：最近一次自动确认的时间

## ⚠️ 安全提示

**重要：此插件会自动确认所有交易请求，请务必注意安全！**

### 安全建议

1. ✅ **仅在受信任的网站使用**
   - 只在知名 DeFi 协议网站使用
   - 避免在不明来源的网站自动确认

2. ✅ **控制资金规模**
   - 钱包中不要存放大量资金
   - 使用专门的「交互钱包」进行 DeFi 操作

3. ✅ **定期检查**
   - 定期查看钱包交易记录
   - 检查是否有异常授权

4. ✅ **及时关闭**
   - 不使用时关闭插件
   - 访问新网站前暂时禁用

### 风险提示

- ⚠️ 插件会自动确认**所有**交易请求
- ⚠️ 无法区分恶意网站和正常网站
- ⚠️ 一旦点击确认，交易立即执行，无法撤回
- ⚠️ 完全自动化模式风险较高，建议仅在测试环境使用

## 🔧 工作原理

### 技术架构

```
┌─────────────────┐
│  Background.js  │ ← 管理配置和状态
└────────┬────────┘
         │
┌────────▼────────┐
│   Content.js    │ ← 监听 DOM 变化
└────────┬────────┘
         │
┌────────▼────────┐
│   Injected.js   │ ← 访问钱包对象
└─────────────────┘
```

### 核心逻辑

1. **DOM 监听**：使用 `MutationObserver` 监听页面 DOM 变化
2. **弹窗检测**：检测 OKX 钱包弹窗的多种可能选择器
3. **按钮定位**：在弹窗中查找确认按钮
4. **延迟点击**：等待配置的延迟时间后点击
5. **通知反馈**：显示绿色提示通知用户

### 支持的按钮选择器

插件会尝试匹配以下按钮：
- `button[data-testid="confirm-footer-button"]`
- `button[class*="confirm"]`
- `button[class*="primary"]`
- 以及更多 OKX 钱包特定的选择器

v2.0.0 新增：**按文本匹配按钮**，自动识别包含以下关键词的按钮：
- 确认 / Confirm
- 签名 / Sign
- 授权 / Approve / Authorize
- 同意 / Agree
- 提交 / Submit

## 🔗 与 DeFi Yield Dashboard 配合使用

本插件 v2.0.0 支持与 DeFi Yield Dashboard 的冷钱包自动化桥接功能集成。

### 使用步骤

1. **安装并启用插件**：按照上面的安装步骤加载插件
2. **连接 OKX 钱包**：确保 OKX Wallet 扩展已安装并解锁
3. **打开 Dashboard**：访问 DeFi Yield Dashboard
4. **启动自动化**：点击「冷钱包自动化桥接」组件的「启动自动化」按钮
5. **自动签名**：当 Dashboard 推送交易时，插件会自动调用 OKX 签名并返回结果

### window.coldWallet API

插件会在页面上下文中暴露 `window.coldWallet` 对象，提供以下方法：

```javascript
// 获取当前钱包地址
const address = await window.coldWallet.getAddress();

// 签名并发送交易
const txHash = await window.coldWallet.signTransaction({
  to: '0x...',           // 目标地址
  value: '0x0',          // 金额（wei，可选）
  data: '0x...',         // 调用数据（可选）
  chainId: 1,            // 链ID（可选，提供则自动切链）
  gas: '0x...',          // Gas 限制（可选）
});
```

### 注意事项

- 插件会自动弹出 OKX 确认窗口，您仍需在硬件钱包上进行最终确认
- 如果启用了「自动确认」功能，插件会自动点击确认按钮
- 建议在白名单中添加 Dashboard 域名以提高安全性

## 🎨 自定义

### 修改延迟时间

在控制面板中调整「确认延迟」：
- **0ms**：立即确认（可能被检测）
- **500ms**：推荐值，平衡速度和安全
- **1000ms+**：更安全，但确认速度较慢

### 扩展功能（未来版本）

- ✨ 金额限制：只自动确认小额交易
- ✨ 详细日志：记录所有交易的完整审计日志
- ✨ 通知设置：自定义通知样式和位置
- ✨ Solana / Aptos 链签名支持

## 📁 文件结构

```
okx-auto-approve/
├── manifest.json          # 插件配置文件
├── background.js          # 后台脚本（管理状态）
├── content.js            # 内容脚本（DOM 监听）
├── injected.js           # 注入脚本（访问钱包）
├── popup.html            # 弹窗界面
├── popup.js              # 弹窗逻辑
├── create-icons.html     # 图标生成工具
├── icon16.png            # 16x16 图标
├── icon48.png            # 48x48 图标
├── icon128.png           # 128x128 图标
└── README.md             # 本文档
```

## 🐛 故障排查

### 插件不工作

1. **检查插件是否启用**
   - 打开 `chrome://extensions/`
   - 确保插件开关是开启状态

2. **检查配置**
   - 点击插件图标
   - 确保「自动确认」和「插件启用」都是开启的

3. **检查控制台**
   - 按 F12 打开开发者工具
   - 查看 Console 标签页
   - 搜索 `[OKX Auto Approve]` 日志

### 没有自动确认

1. **确认 OKX 钱包已安装**
   - 必须先安装 OKX Wallet 扩展

2. **检查网站兼容性**
   - 某些网站可能使用不同的弹窗结构
   - 查看控制台是否有检测日志

3. **增加延迟时间**
   - 弹窗可能需要更多时间渲染
   - 尝试将延迟设置为 1000ms

### 确认太快或太慢

调整「确认延迟」选项：
- 太快：增加延迟（如 1000ms）
- 太慢：减少延迟（如 300ms）

## 📝 开发日志

### v2.0.0 (2026-02-07)

- ✨ **Dashboard 对接**：新增 `window.coldWallet` API，支持与 DeFi Yield Dashboard 冷钱包桥接集成
- 🔧 **修复按钮选择器**：移除无效的 `:contains()` 选择器，改用按文本内容匹配
- 📝 **白名单/黑名单 UI**：在 popup 中新增白名单和黑名单编辑界面
- 🔗 **多链支持**：支持通过 `chainId` 参数自动切换链
- 📡 **消息通信**：支持通过 postMessage 与 Dashboard 双向通信

### v1.0.0 (2026-02-07)

- ✅ 初始版本发布
- ✅ 支持 OKX 钱包自动确认
- ✅ 支持所有 EVM 链
- ✅ 精美的控制面板
- ✅ 统计功能
- ✅ 延迟配置

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可

MIT License

---

**免责声明**：使用此插件的所有风险由用户自行承担。作者不对因使用此插件导致的任何损失负责。请在充分理解风险的前提下谨慎使用。

---

**开发者**: Nexus Yield Team  
**项目**: Nexus Yield: 智能资产矩阵  
**联系**: 见主项目 README
