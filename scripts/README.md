# è…³æœ¬å·¥å…·èªªæ˜

æœ¬ç›®éŒ„åŒ…å«é …ç›®ç®¡ç†å’Œéƒ¨ç½²æ‰€éœ€çš„å„ç¨®è…³æœ¬å·¥å…·ã€‚

## ğŸ“œ è…³æœ¬åˆ—è¡¨

### ğŸ—„ï¸ æ•¸æ“šåº«ç®¡ç†

#### `start-database.sh`
ä¸€éµå•Ÿå‹• TimescaleDB æ•¸æ“šåº«ä¸¦é€²è¡Œå¥åº·æª¢æŸ¥ã€‚

**ç”¨æ³•ï¼š**
```bash
# åƒ…å•Ÿå‹•æ•¸æ“šåº«
bash scripts/start-database.sh

# å•Ÿå‹•æ•¸æ“šåº« + Redis + Grafana
bash scripts/start-database.sh --all

# å•Ÿå‹•ä¸¦é¡¯ç¤ºæ—¥èªŒ
bash scripts/start-database.sh --logs

# æŸ¥çœ‹å¹«åŠ©
bash scripts/start-database.sh --help
```

**åŠŸèƒ½ï¼š**
- âœ… æª¢æŸ¥ Docker é‹è¡Œç‹€æ…‹
- âœ… åŠ è¼‰ç’°å¢ƒè®Šé‡
- âœ… å•Ÿå‹•æ•¸æ“šåº«å®¹å™¨
- âœ… ç­‰å¾…æ•¸æ“šåº«å°±ç·’
- âœ… é©—è­‰é€£æ¥
- âœ… é¡¯ç¤ºé€£æ¥ä¿¡æ¯

#### `check-database.sh`
å¿«é€Ÿæª¢æŸ¥æ•¸æ“šåº«è¡¨çµæ§‹å’Œæ•¸æ“šã€‚

**ç”¨æ³•ï¼š**
```bash
bash scripts/check-database.sh
```

**æª¢æŸ¥å…§å®¹ï¼š**
- ğŸ“Š è¡¨åˆ—è¡¨
- ğŸ”— chains è¡¨ï¼ˆå€å¡Šéˆï¼‰
- ğŸ’§ pools è¡¨ï¼ˆæµå‹•æ€§æ± ï¼‰
- ğŸ›ï¸ protocols è¡¨ï¼ˆå”è­°ï¼‰
- âš™ï¸ system_config è¡¨ï¼ˆç³»çµ±é…ç½®ï¼‰

---

### ğŸš€ éƒ¨ç½²å·¥å…·

#### `deploy-update.sh`
è‡ªå‹•åŒ–éƒ¨ç½²æ¡Œé¢æ‡‰ç”¨æ›´æ–°åˆ°æœå‹™å™¨ã€‚

**ç”¨æ³•ï¼š**
```bash
# éƒ¨ç½²æ›´æ–°
bash scripts/deploy-update.sh
```

**æµç¨‹ï¼š**
1. æª¢æŸ¥æœ¬åœ°æ‰“åŒ…æ–‡ä»¶
2. é¡¯ç¤ºå¾…ä¸Šå‚³æ–‡ä»¶åˆ—è¡¨
3. ç¢ºèªå¾Œä¸Šå‚³åˆ°æœå‹™å™¨
4. é©—è­‰é ç¨‹æ–‡ä»¶

**é…ç½®ï¼š**
```bash
# åœ¨è…³æœ¬ä¸­ä¿®æ”¹é€™äº›è®Šé‡
SERVER_USER="root"
SERVER_HOST="YOUR_UPDATE_SERVER"
SERVER_PORT="22"
UPDATE_DIR="/var/www/updates"
```

#### `setup-nginx-updates.sh`
ç”Ÿæˆ Nginx é…ç½®ä»¥æä¾›æ›´æ–°æ–‡ä»¶æœå‹™ã€‚

**ç”¨æ³•ï¼š**
```bash
bash scripts/setup-nginx-updates.sh
```

**é¸é …ï¼š**
1. ç”Ÿæˆæ–°çš„ Nginx é…ç½®æ–‡ä»¶ï¼ˆæ¨è–¦ï¼‰
2. ç”Ÿæˆé…ç½®ç‰‡æ®µï¼ˆæ·»åŠ åˆ°ç¾æœ‰é…ç½®ï¼‰
3. åƒ…é¡¯ç¤ºé…ç½®ç¤ºä¾‹

---

### ğŸ› ï¸ å…¶ä»–å·¥å…·

#### `setup.sh`
é …ç›®åˆå§‹åŒ–è…³æœ¬ï¼ˆåŸæœ‰è…³æœ¬ï¼‰ã€‚

**ç”¨æ³•ï¼š**
```bash
bash scripts/setup.sh
```

#### `seed-real-data.ts`
å¡«å……çœŸå¯¦æ•¸æ“šåˆ°æ•¸æ“šåº«ï¼ˆTypeScriptï¼‰ã€‚

**ç”¨æ³•ï¼š**
```bash
pnpm seed
```

#### `clear-test-data.ts`
æ¸…ç©ºæ¸¬è©¦/å‡æ•¸æ“šï¼ˆäº¤æ˜“è¡¨ã€æŒå€‰è¡¨ï¼‰ã€‚ç„¡å‡æ•¸æ“šæ™‚å¯å®šæœŸåŸ·è¡Œä»¥ä¿æŒä»‹é¢ä¹¾æ·¨ã€‚

**ç”¨æ³•ï¼š**
```bash
# éœ€å…ˆè¨­ç½®æ•¸æ“šåº«ç’°å¢ƒè®Šé‡ï¼ˆæˆ–ä½¿ç”¨é …ç›®æ ¹ç›®éŒ„ .envï¼‰
pnpm run clear-test-data
```

**èªªæ˜ï¼š** æœƒåˆªé™¤ `transactions` èˆ‡ `positions` è¡¨å…§å…¨éƒ¨è¨˜éŒ„ï¼Œä¸å½±éŸ¿æ± å­ã€å”è­°ç­‰å…¶å®ƒè¡¨ã€‚

---

## ğŸ”§ å¸¸ç”¨å·¥ä½œæµ

### é¦–æ¬¡è¨­ç½®

```bash
# 1. å•Ÿå‹•æ•¸æ“šåº«
bash scripts/start-database.sh --all

# 2. æª¢æŸ¥æ•¸æ“šåº«
bash scripts/check-database.sh

# 3. å®‰è£ä¾è³´
pnpm install

# 4. å•Ÿå‹•é–‹ç™¼æœå‹™
cd packages/dashboard && pnpm dev
```

### ç™¼å¸ƒæ–°ç‰ˆæœ¬

```bash
# 1. æ›´æ–°ç‰ˆæœ¬è™Ÿä¸¦æ‰“åŒ…
cd packages/desktop
npm version patch
pnpm build

# 2. éƒ¨ç½²åˆ°æœå‹™å™¨
cd ../..
bash scripts/deploy-update.sh

# 3. é©—è­‰
curl -I https://YOUR_UPDATE_SERVER/updates/latest.yml
```

### æ•¸æ“šåº«ç¶­è­·

```bash
# å•Ÿå‹•æ•¸æ“šåº«
bash scripts/start-database.sh

# æª¢æŸ¥æ•¸æ“š
bash scripts/check-database.sh

# æŸ¥çœ‹æ—¥èªŒ
docker compose logs -f timescaledb

# é€²å…¥å‘½ä»¤è¡Œ
docker compose exec timescaledb psql -U defi -d defi_yield
```

---

## ğŸ“‚ è…³æœ¬æ–‡ä»¶ä½ç½®

```
scripts/
â”œâ”€â”€ README.md                    # æœ¬æ–‡æª”
â”œâ”€â”€ start-database.sh           # æ•¸æ“šåº«å•Ÿå‹•è…³æœ¬ â­
â”œâ”€â”€ check-database.sh           # æ•¸æ“šåº«æª¢æŸ¥è…³æœ¬ â­
â”œâ”€â”€ deploy-update.sh            # æ›´æ–°éƒ¨ç½²è…³æœ¬ â­
â”œâ”€â”€ setup-nginx-updates.sh      # Nginx é…ç½®ç”Ÿæˆå™¨ â­
â”œâ”€â”€ setup.sh                    # é …ç›®åˆå§‹åŒ–ï¼ˆåŸæœ‰ï¼‰
â”œâ”€â”€ seed-real-data.ts           # æ•¸æ“šå¡«å……ï¼ˆåŸæœ‰ï¼‰
â”œâ”€â”€ clear-test-data.ts          # æ¸…ç©ºæ¸¬è©¦æ•¸æ“š
â””â”€â”€ clear-test-data.sql         # æ¸…ç©ºæ¸¬è©¦æ•¸æ“šï¼ˆSQLï¼Œå¯é¸ï¼‰
```

â­ æ¨™è¨˜ç‚ºæœ¬æ¬¡æ–°å¢æˆ–æ›´æ–°çš„è…³æœ¬

---

## ğŸ” æ¬Šé™è¨­ç½®

æ‰€æœ‰è…³æœ¬å·²è¨­ç½®å¯åŸ·è¡Œæ¬Šé™ã€‚å¦‚éœ€æ‰‹å‹•è¨­ç½®ï¼š

```bash
chmod +x scripts/*.sh
```

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [å¿«é€Ÿé–‹å§‹](../docs/å¿«é€Ÿå¼€å§‹.md)
- [æ•¸æ“šåº«å•Ÿå‹•æŒ‡å—](../docs/æ•°æ®åº“å¯åŠ¨æŒ‡å—.md)
- [Git èˆ‡æ›´æ–°é…ç½®](../docs/GITä¸æ›´æ–°é…ç½®è¯´æ˜.md)
- [æ¡Œé¢æ‡‰ç”¨ç™¼å¸ƒæµç¨‹](../packages/desktop/RELEASE.md)

---

## âš ï¸ æ³¨æ„äº‹é …

1. **æ•¸æ“šåº«è…³æœ¬**
   - éœ€è¦ Docker é‹è¡Œ
   - æœƒè®€å–é …ç›®æ ¹ç›®éŒ„çš„ `.env` æ–‡ä»¶
   - é»˜èªç«¯å£ï¼š5433

2. **éƒ¨ç½²è…³æœ¬**
   - éœ€è¦é…ç½® SSH å…å¯†ç™»éŒ„åˆ°æœå‹™å™¨
   - æˆ–åœ¨é‹è¡Œæ™‚è¼¸å…¥å¯†ç¢¼
   - ç¢ºä¿æœå‹™å™¨æœ‰è¶³å¤ ç©ºé–“

3. **Nginx é…ç½®**
   - ç”Ÿæˆçš„é…ç½®éœ€è¦æ‰‹å‹•éƒ¨ç½²åˆ°æœå‹™å™¨
   - ç¢ºä¿æ›´æ–°æœå‹™æ‰€ç”¨ç«¯å£æœªè¢«ä½”ç”¨
   - æ¸¬è©¦é…ç½®ï¼š`nginx -t`

---

**æœ€å¾Œæ›´æ–°ï¼š** 2026-02-07
